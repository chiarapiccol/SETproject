<div class="bubbleChartComponent">

  <mat-toolbar class="upperLine">
    <button mat-icon-button (click)="drawer.toggle()"><mat-icon>menu</mat-icon></button>
    <span style='font-size:80%'>Countries and their energetical, material, and socioeconomical aspects </span>
    <span class="spacer"></span>
    <button mat-icon-button (click)="blockVis()" matTooltip={{toppTioIcon}}><mat-icon>{{blockIcon}}</mat-icon></button>
  </mat-toolbar>

  <mat-drawer-container class="container" autosize>
    <mat-drawer class="drawer" #drawer mode="side">

      <div class="perspectiveSel">

        <mat-chip-listbox class="mat-mdc-chip-set-stacked" aria-label="Fish selection">
          <mat-chip-option selected (selectionChange)="chooseVisWorld($event.selected)">World View</mat-chip-option>
          <mat-chip-option (selectionChange)="chooseVisCountries($event.selected)">Countries View</mat-chip-option>
        </mat-chip-listbox>

      </div>

      <div class="worldView" [hidden]="hideFilterWorld">

        <mat-accordion class="accordion-countries" multi>
          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-icon>check_circle</mat-icon>
                Colors
              </mat-panel-title>
              <mat-panel-description>
              </mat-panel-description>
            </mat-expansion-panel-header>
            <mat-form-field>
              <mat-label>Colors</mat-label>
              <mat-select [ngModel]="selectedColor" (selectionChange)="checkCol($event.value)" multiple>

                <mat-option *ngFor="let eS of chartFiltersOptions[0].subCat" [value]="eS"
                  (onSelectionChange)="returnLastClick(eS)" [ngStyle]="setMarginsFilterOptions(eS)">{{ eS
                  }}</mat-option>

                <mat-option *ngFor="let eS of chartFiltersOptions[1].subCat" [value]="eS"
                  (onSelectionChange)="returnLastClick(eS)" [ngStyle]="setMarginsFilterOptions(eS)">{{ eS
                  }}</mat-option>

                <mat-option *ngFor="let eS of chartFiltersOptions[2].subCat" [value]="eS"
                  (onSelectionChange)="returnLastClick(eS)" [ngStyle]="setMarginsFilterOptions(eS)">{{ eS
                  }}</mat-option>
                <mat-divider></mat-divider>

                <mat-option *ngFor="let eS of chartFiltersOptions[3].subCat" [value]="eS"
                  (onSelectionChange)="returnLastClick(eS)" [ngStyle]="setMarginsFilterOptions(eS)">{{ eS
                  }}</mat-option>
                <mat-divider></mat-divider>

                <mat-option *ngFor="let eS of chartFiltersOptions[4].subCat" [value]="eS"
                  (onSelectionChange)="returnLastClick(eS)" [ngStyle]="setMarginsFilterOptions(eS)">{{ eS
                  }}</mat-option>

                <mat-option *ngFor="let eS of chartFiltersOptions[5].subCat" [value]="eS"
                  (onSelectionChange)="returnLastClick(eS)" [ngStyle]="setMarginsFilterOptions(eS)">{{ eS
                  }}</mat-option>

                <mat-option *ngFor="let eS of chartFiltersOptions[6].subCat" [value]="eS"
                  (onSelectionChange)="returnLastClick(eS)" [ngStyle]="setMarginsFilterOptions(eS)">{{ eS
                  }}</mat-option>
              </mat-select>
            </mat-form-field>
          </mat-expansion-panel>

          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-icon>check_circle</mat-icon>
                Technologies
              </mat-panel-title>
              <mat-panel-description>
              </mat-panel-description>
            </mat-expansion-panel-header>
            <mat-form-field>
              <mat-label> Other renew. technologies</mat-label>
              <mat-select [(ngModel)]="selectedExtraTech" (selectionChange)="checkExtraTech()" multiple>

                <mat-option *ngFor="let exT of listExtraTech; index as i" [value]="exT">{{fullNameListExtraTech[i]}}</mat-option>

              </mat-select>
            </mat-form-field>
          </mat-expansion-panel>
        </mat-accordion>
      </div>

      <div class="countriesView" [hidden]="hideFilterCountries">

        <mat-accordion class="accordion-countries" multi>
          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-icon>check_circle</mat-icon>
                Colors
              </mat-panel-title>
              <mat-panel-description>
              </mat-panel-description>
            </mat-expansion-panel-header>
            <mat-form-field>
              <mat-label>Colors</mat-label>
              <mat-select [ngModel]="selectedColor" (selectionChange)="checkCol($event.value)" multiple>

                <mat-option *ngFor="let eS of chartFiltersOptions[0].subCat" [value]="eS"
                  (onSelectionChange)="returnLastClick(eS)" [ngStyle]="setMarginsFilterOptions(eS)">{{ eS
                  }}</mat-option>

                <mat-option *ngFor="let eS of chartFiltersOptions[1].subCat" [value]="eS"
                  (onSelectionChange)="returnLastClick(eS)" [ngStyle]="setMarginsFilterOptions(eS)">{{ eS
                  }}</mat-option>

                <mat-option *ngFor="let eS of chartFiltersOptions[2].subCat" [value]="eS"
                  (onSelectionChange)="returnLastClick(eS)" [ngStyle]="setMarginsFilterOptions(eS)">{{ eS
                  }}</mat-option>
                <mat-divider></mat-divider>

                <mat-option *ngFor="let eS of chartFiltersOptions[3].subCat" [value]="eS"
                  (onSelectionChange)="returnLastClick(eS)" [ngStyle]="setMarginsFilterOptions(eS)">{{ eS
                  }}</mat-option>
                <mat-divider></mat-divider>

                <mat-option *ngFor="let eS of chartFiltersOptions[4].subCat" [value]="eS"
                  (onSelectionChange)="returnLastClick(eS)" [ngStyle]="setMarginsFilterOptions(eS)">{{ eS
                  }}</mat-option>

                <mat-option *ngFor="let eS of chartFiltersOptions[5].subCat" [value]="eS"
                  (onSelectionChange)="returnLastClick(eS)" [ngStyle]="setMarginsFilterOptions(eS)">{{ eS
                  }}</mat-option>

                <mat-option *ngFor="let eS of chartFiltersOptions[6].subCat" [value]="eS"
                  (onSelectionChange)="returnLastClick(eS)" [ngStyle]="setMarginsFilterOptions(eS)">{{ eS
                  }}</mat-option>
              </mat-select>
            </mat-form-field>
          </mat-expansion-panel>

          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-icon>check_circle</mat-icon>
                Size
              </mat-panel-title>
              <mat-panel-description>
              </mat-panel-description>
            </mat-expansion-panel-header>
            <mat-form-field>
              <mat-label>Size</mat-label>
              <mat-select [ngModel]="selectedSize" (selectionChange)="checkSize($event.value)" multiple>

                <mat-option *ngFor="let eS of chartFiltersOptions[0].subCat" [value]="eS"
                  (onSelectionChange)="returnLastClick(eS)" [ngStyle]="setMarginsFilterOptions(eS)">{{ eS
                  }}</mat-option>

                <mat-option *ngFor="let eS of chartFiltersOptions[1].subCat" [value]="eS"
                  (onSelectionChange)="returnLastClick(eS)" [ngStyle]="setMarginsFilterOptions(eS)">{{ eS
                  }}</mat-option>

                <mat-option *ngFor="let eS of chartFiltersOptions[2].subCat" [value]="eS"
                  (onSelectionChange)="returnLastClick(eS)" [ngStyle]="setMarginsFilterOptions(eS)">{{ eS
                  }}</mat-option>
                <mat-divider></mat-divider>

                <mat-option *ngFor="let eS of chartFiltersOptions[3].subCat" [value]="eS"
                  (onSelectionChange)="returnLastClick(eS)" [ngStyle]="setMarginsFilterOptions(eS)">{{ eS
                  }}</mat-option>
                <mat-divider></mat-divider>

                <mat-option *ngFor="let eS of chartFiltersOptions[4].subCat" [value]="eS"
                  (onSelectionChange)="returnLastClick(eS)" [ngStyle]="setMarginsFilterOptions(eS)">{{ eS
                  }}</mat-option>

                <mat-option *ngFor="let eS of chartFiltersOptions[5].subCat" [value]="eS"
                  (onSelectionChange)="returnLastClick(eS)" [ngStyle]="setMarginsFilterOptions(eS)">{{ eS
                  }}</mat-option>

                <mat-option *ngFor="let eS of chartFiltersOptions[6].subCat" [value]="eS"
                  (onSelectionChange)="returnLastClick(eS)" [ngStyle]="setMarginsFilterOptions(eS)">{{ eS
                  }}</mat-option>
              </mat-select>
            </mat-form-field>
          </mat-expansion-panel>

          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-icon>check_circle</mat-icon>
                X-coordinates
              </mat-panel-title>
              <mat-panel-description>
              </mat-panel-description>
            </mat-expansion-panel-header>
            <mat-form-field>
              <mat-label>x-ccord.</mat-label>
              <mat-select [ngModel]="selectedX" (selectionChange)="checkX($event.value)" multiple>

                <mat-option *ngFor="let eS of chartFiltersOptions[0].subCat" [value]="eS"
                  (onSelectionChange)="returnLastClick(eS)" [ngStyle]="setMarginsFilterOptions(eS)">{{ eS
                  }}</mat-option>

                <mat-option *ngFor="let eS of chartFiltersOptions[1].subCat" [value]="eS"
                  (onSelectionChange)="returnLastClick(eS)" [ngStyle]="setMarginsFilterOptions(eS)">{{ eS
                  }}</mat-option>

                <mat-option *ngFor="let eS of chartFiltersOptions[2].subCat" [value]="eS"
                  (onSelectionChange)="returnLastClick(eS)" [ngStyle]="setMarginsFilterOptions(eS)">{{ eS
                  }}</mat-option>
                <mat-divider></mat-divider>

                <mat-option *ngFor="let eS of chartFiltersOptions[3].subCat" [value]="eS"
                  (onSelectionChange)="returnLastClick(eS)" [ngStyle]="setMarginsFilterOptions(eS)">{{ eS
                  }}</mat-option>
                <mat-divider></mat-divider>

                <mat-option *ngFor="let eS of chartFiltersOptions[4].subCat" [value]="eS"
                  (onSelectionChange)="returnLastClick(eS)" [ngStyle]="setMarginsFilterOptions(eS)">{{ eS
                  }}</mat-option>

                <mat-option *ngFor="let eS of chartFiltersOptions[5].subCat" [value]="eS"
                  (onSelectionChange)="returnLastClick(eS)" [ngStyle]="setMarginsFilterOptions(eS)">{{ eS
                  }}</mat-option>

                <mat-option *ngFor="let eS of chartFiltersOptions[6].subCat" [value]="eS"
                  (onSelectionChange)="returnLastClick(eS)" [ngStyle]="setMarginsFilterOptions(eS)">{{ eS
                  }}</mat-option>
              </mat-select>
            </mat-form-field>
          </mat-expansion-panel>

          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-icon>check_circle</mat-icon>
                Y-coordinates
              </mat-panel-title>
              <mat-panel-description>
              </mat-panel-description>
            </mat-expansion-panel-header>
            <mat-form-field>
              <mat-label>y-coord.</mat-label>
              <mat-select [ngModel]="selectedY" (selectionChange)="checkY($event.value)" multiple>

                <mat-option *ngFor="let eS of chartFiltersOptions[0].subCat" [value]="eS"
                  (onSelectionChange)="returnLastClick(eS)" [ngStyle]="setMarginsFilterOptions(eS)">{{ eS
                  }}</mat-option>

                <mat-option *ngFor="let eS of chartFiltersOptions[1].subCat" [value]="eS"
                  (onSelectionChange)="returnLastClick(eS)" [ngStyle]="setMarginsFilterOptions(eS)">{{ eS
                  }}</mat-option>

                <mat-option *ngFor="let eS of chartFiltersOptions[2].subCat" [value]="eS"
                  (onSelectionChange)="returnLastClick(eS)" [ngStyle]="setMarginsFilterOptions(eS)">{{ eS
                  }}</mat-option>
                <mat-divider></mat-divider>

                <mat-option *ngFor="let eS of chartFiltersOptions[3].subCat" [value]="eS"
                  (onSelectionChange)="returnLastClick(eS)" [ngStyle]="setMarginsFilterOptions(eS)">{{ eS
                  }}</mat-option>
                <mat-divider></mat-divider>

                <mat-option *ngFor="let eS of chartFiltersOptions[4].subCat" [value]="eS"
                  (onSelectionChange)="returnLastClick(eS)" [ngStyle]="setMarginsFilterOptions(eS)">{{ eS
                  }}</mat-option>

                <mat-option *ngFor="let eS of chartFiltersOptions[5].subCat" [value]="eS"
                  (onSelectionChange)="returnLastClick(eS)" [ngStyle]="setMarginsFilterOptions(eS)">{{ eS
                  }}</mat-option>

                <mat-option *ngFor="let eS of chartFiltersOptions[6].subCat" [value]="eS"
                  (onSelectionChange)="returnLastClick(eS)" [ngStyle]="setMarginsFilterOptions(eS)">{{ eS
                  }}</mat-option>
              </mat-select>
            </mat-form-field>
          </mat-expansion-panel>

          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-icon>add_location</mat-icon>
                Countries
              </mat-panel-title>
              <mat-panel-description>
              </mat-panel-description>
            </mat-expansion-panel-header>

            <mat-form-field>
              <mat-label>Select countries</mat-label>
              <mat-select [(ngModel)]="toFetchCountrs" multiple (ngModelChange)="checkCountr()">
                <input class="countrySearch" placeholder="Search" (keyup)="onKey($event)">
                <mat-option *ngFor="let state of countries" [value]="state"
                  [style.display]="selectedCountries.includes(state)? 'block' : 'none'">{{ state }}</mat-option>
              </mat-select>
            </mat-form-field>
          </mat-expansion-panel>

          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-icon>check_circle</mat-icon>
                Technologies
              </mat-panel-title>
              <mat-panel-description>
              </mat-panel-description>
            </mat-expansion-panel-header>
            <mat-form-field>
              <mat-label> Other renew. technologies</mat-label>
              <mat-select [(ngModel)]="selectedExtraTech" (selectionChange)="checkExtraTech()" multiple>

                <mat-option *ngFor="let exT of listExtraTech; index as i" [value]="exT">{{fullNameListExtraTech[i]}}</mat-option>

              </mat-select>
            </mat-form-field>
          </mat-expansion-panel>

        </mat-accordion>

        <div class="extraSpace"> </div>
      </div>

    </mat-drawer>

    <mat-drawer-content id="content">

      <div id="pieChartPlot" #pieChartPlot (resized)="onPieResize($event)">

        <svg id="pieChartPlot_svg"></svg>

        <div id="pieChartPlot_tooltip"
          style="position: fixed; z-index: 10; visibility: hidden; top: 100px; left: 100px;">
        </div>

      </div>

    </mat-drawer-content>

  </mat-drawer-container>

</div>